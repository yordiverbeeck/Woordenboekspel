<!DOCTYPE html>
<html>

<head>
    <title>Woordenboekspel</title>
    <meta charset="UTF-8">
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131523699-2"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-131523699-2');
	</script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style/main.css">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <style>
    	.form-signin {
			width: 100%;
			max-width: 400px;
			padding: 15px;
			margin: auto;
		}
		.form-signin .checkbox {
			font-weight: 400;
		}
		.form-signin .form-control {
			position: relative;
			box-sizing: border-box;
			height: auto;
			padding: 10px;
			font-size: 16px;
		}
		.form-signin .form-control:focus {
			z-index: 2;
		}
		.form-signin input[type="text"] {
			margin-bottom: 10px;
			border-top-left-radius: 0;
			border-top-right-radius: 0;
		}
		#logo > img:hover{
			cursor: pointer;
		}
    </style>	
</head>

<body class="text-center">
	<div class="container">
		<div class="row justify-content-md-center" id="logo">
			<img class="mb-2" src="images/woordenboekspel.png" alt="" width="500">
			<img class="mb-2" src="images/whoordenboekspel.png" alt="" width="500" style="display: none;">
		</div>
		<div class="row">
		    <form class="form-signin">
		        <h1 class="h3 mb-3 font-weight-normal">Welgekomen, jij daar!</h1>
		        <label for="username" class="sr-only">Wat is je username?</label>
		        <input type="text" id="username" class="form-control" placeholder="Username" required="" autofocus="">

		        <label for="inputRoomID" class="sr-only">Kamer nummer</label>
		        <input type="text" id="inputRoomID" class="form-control" placeholder="Kamer nummer" required="" autofocus="">
		        <div class="usernametooltip" data-toggle="tooltip" title="Vul een username in om verder te gaan">
		        	<a href="#" id="betreedKamer" class="btn btn-lg btn-primary btn-block disabled">Betreed kamer</a>
		        </div>

		        <p class="mt-3 mb-2 ">OF maak een nieuwe kamer</p>
		        <div class="usernametooltip"  data-toggle="tooltip" title="Vul een username in om verder te gaan">
		        	<a href="#" id="createRoom" class="btn btn-lg btn-sm btn-primary btn-block disabled usernametooltip">Maak een kamer</a>
		        </div>
		        <p class="mt-5 mb-3 text-muted" id="errorlog"></p>
		    </form>
		</div>
	</div>
    <footer class="footer">
		<div class="container position-absolute" style="left:0;right:0 ">
			<span class="text-muted">Door jouw liefste kapoen, <a href="https://www.instagram.com/yordinateur/">Yordi Verbeeck</a> van Sjarel</span><br>
			<span class="text-muted">Geïnspireerd op de livestreams van Thomas Huyghe</span>
		</div>
		<!-- Button trigger modal -->
		<button type="button" class="btn float-right position-absolute" data-toggle="modal" data-target="#watisdit" style="right:0">
			<svg class="bi bi-question-circle-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
				  <path fill-rule="evenodd" d="M16 8A8 8 0 110 8a8 8 0 0116 0zM6.57 6.033H5.25C5.22 4.147 6.68 3.5 8.006 3.5c1.397 0 2.673.73 2.673 2.24 0 1.08-.635 1.594-1.244 2.057-.737.559-1.01.768-1.01 1.486v.355H7.117l-.007-.463c-.038-.927.495-1.498 1.168-1.987.59-.444.965-.736.965-1.371 0-.825-.628-1.168-1.314-1.168-.901 0-1.358.603-1.358 1.384zm1.251 6.443c-.584 0-1.009-.394-1.009-.927 0-.552.425-.94 1.01-.94.609 0 1.028.388 1.028.94 0 .533-.42.927-1.029.927z" clip-rule="evenodd"/>
				</svg>
		</button>


    </footer>


    <!-- Modal -->
	<div class="modal fade" id="watisdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLongTitle">Hiersedaarse!</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body text-justify">
					<h4>Wat is dit?</h4>
					<p>Dit is het Woordenboekspel! Een gezelschapsspel dat je speelt met vrienden en/of familie. Het bestaat al een tijdje hoor.</p>

					<h4>Met hoeveel mensen kan ik dit spelen?</h4>
					<p><b>Minstens 3!</b> Anders is er niet veel gokken aan hé. Er staat momenteel geen maximum op. Al kan het wel wat lang duren als je met meer dan 100 mensen speelt.</p>

					<h4>Hoe werkt het Woordenboekspel?</h4>
					<p>Je speelt dit spel met <b>gezellige mensen en een woordenboek</b>. Een ronde gaat als volgt: </p><p>1) Iemand kiest een onbekend woord uit het woordenboek en geeft dit door aan de andere. <br>2) Iedereen creatief aan de slag om een definitie van het woord te bedenken. <br>3) Als iedereen klaar is worden alle definities, samen met de echte definitie, op willekeurige volgorde bij gezet. Iedereen kan dan stemmen welke definitie de echte is. <br>4) <i>Vergeet ook niet je goed humeur mee te nemen! haha ha....h</i></p>

					<h4>Hoe werkt de puntentelling?</h4>
					<p>Je kan op 3 manieren punten verdienen. </p><p>1) Je krijgt één punt als je het juiste woord hebt geselecteerd. <br>2) Je krijgt één punt per persoon die jouw definitie als de juiste definitie heeft aangeduid. <br>3) Je krijgt twee punten als niemand bij jouw woord, de echte definitie kon raden.</p>

					<h4>Wie houd zich hier mee bezig en waarom?</h4>
					<p>Ik! Yordi Verbeeck, ik verveelde me en had zin om iets te maken. Ik keek naar de livestreams van Thomas Huyghe waar men dit spel speelde (op een soms nogal klungelige manier #nooffence). Toen ik het ook wilde spelen kwam ik er achter dat er nog geen online versie van bestond. Dan heb ik het zelf maar gemaakt.</p>

					<h4>'T werkt ni!?</h4>
					<p>Ja sorry hoor, stank voor dank noem ik dat!<br> Serieus antwoord: Dit spel staat nog maar net online. (sinds  1 mei 2020...) De kans dat er bugs in zitten of de spelervaring niet optimaal is, is 100%. Je mag alle vormen van feedback doorsturen naar <a href="mailto:hello@yordi.net">hello@yordi.net</a>. Bedankt!</p>

					<h5 class="text-center text-muted">FLOOR GANG</h5>
				</div>
			</div>
		</div>
	</div>

    <!-- Als je dit leest, sorry voor de rommelige code. Ik heb er letterlijk maar een paar dagen aan gesleuteld om het ASAP te maken. Verwacht bugs en inefficiencies -->

    <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>
    <script>
		$(document).ready(function() {
		    var firebaseConfig = {
		        apiKey: "AIzaSyB1S5WKU4vVJHON2sEp1fk2hu0zH_Cxa0g",
		        authDomain: "woordenboekspel-a120d.firebaseapp.com",
		        databaseURL: "https://woordenboekspel-a120d.firebaseio.com",
		        projectId: "woordenboekspel-a120d",
		        storageBucket: "woordenboekspel-a120d.appspot.com",
		        messagingSenderId: "6191639396",
		        appId: "1:6191639396:web:9cbdf498bdc2fea47e6871",
		        measurementId: "G-X1MWL08VFS"
		    };
		    // Initialize Firebase
		    firebase.initializeApp(firebaseConfig);
		    firebase.analytics();
        	var db = firebase.firestore();

        	if($("#inputRoomID").val()!=""){
		        $('#betreedKamer').removeClass('disabled');   
        	}

        	$(".usernametooltip").tooltip({
        		placement:'bottom'
        	});

        	$(document).on('click', '#createRoom', function(event) {
        		event.preventDefault();
        		$("#createRoom").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
        		db.collection("rooms").add({
        			huidigWoord:1,
        			roomname: "",
        			startedAt:new Date,
        			status:"new",
        			shortroom:makeid(10)
        		}).then(function(docRef){
        			//make user before redirect
        			console.log("roomid: "+docRef.id);

        			//add user
        			db.collection("rooms").doc(docRef.id).collection("users").add({
	        			allowed: true,
	        			createdDate: new Date,
	        			punten:0,
	        			username: $("#username").val().length!=0 ? $("#username").val() : "user-"+makeid(4),
	        			admin:true
	        		}).then(function(userdocRef){

	        			//add default woord
	        			db.collection("rooms").doc(docRef.id).collection("woorden").add({
		        			createdDate: new Date,
		        			status: "new",
		        			wordOwner: userdocRef.id,
		        			woord:""
		        		}).then(function(newWordRef){

		        			//make user before redirect
		        			console.log("roomid: "+userdocRef.id);
		        			localStorage.setItem("WBS-"+docRef.id,userdocRef.id);
		        			if(localStorage.getItem("WBS-"+docRef.id)==userdocRef.id){
		        				window.location.href ="kamer.html?kamer="+docRef.id;
		        			}else{
		        				alert("kan storage niet zetten :'( De serverowner wordt genotificeerd.");
		        				console.log("can't set localStorage");
		        			}

		        		}).catch(function(error) {
							console.error("Error creating first woorden: ", error);
							alert("Er ging ergens iets mis, sorry!");
						});

	        		}).catch(function(error) {
						console.error("Error creating user: ", error);
						alert("Er ging ergens iets mis, sorry!");
					});

        		}).catch(function(error) {
					console.error("Error adding document: ", error);
					$("#createRoom").text("Maak een kamer");
				});

        	}).on('click', '#betreedKamer', function(event) {
        		event.preventDefault();
        		if(!$(this).hasClass('disabled')){
        			$("#betreedKamer").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
					var enteredId = $("#inputRoomID").val();
					db.collection('rooms').where('shortroom',"==",enteredId).orderBy('startedAt','desc').get().then(function(querySnapshot){
						if(!querySnapshot.empty) {
							querySnapshot.forEach(function(doc) {
								//make user before redirect
								db.collection("rooms").doc(doc.id).collection("users").add({
				        			allowed: true,
				        			createdDate: new Date,
				        			punten: 0,
				        			username: $("#username").val().length!=0 ? $("#username").val() : "user-"+makeid(4),
				        			admin: false
				        		}).then(function(userdocRef){
				        			//make user before redirect
				        			console.log("roomid: "+userdocRef.id);
				        			localStorage.setItem("WBS-"+doc.id,userdocRef.id);
				        			if(localStorage.getItem("WBS-"+doc.id)==userdocRef.id){
				        				window.location.href ="kamer.html?kamer="+doc.id;
				        			}else{
				        				alert("kan storage niet zetten :'( De serverowner wordt genotificeerd.");
				        				console.log("can't set localStorage");
				        			}
				        		}).catch(function(error) {
									console.error("Error creating user: ", error);
									alert("Er ging ergens iets mis, sorry!");
								});
							}).catch(function(error) {
								console.error("Error finding document: ", error);
								$("#betreedKamer").text("Betreed kamer");
							});
						}else{
							$("#errorlog").text("Invalid room!");
							$("#betreedKamer").text("Betreed kamer");
							console.log("room not found... "+enteredId)
						}
					});
        		}
        	}).on('keyup', '#inputRoomID', function(event) {
        		event.preventDefault();
				$("#username").val().length != 0 ? $(".usernametooltip").tooltip('disable') : $(".usernametooltip").tooltip('enable'); 
        		if($(this).val().length !=0 && $("#username").val().length != 0){
		            $('#betreedKamer').removeClass('disabled'); 
		        }else{
		            $('#betreedKamer').addClass('disabled');
    			}
	       	}).on('keyup', '#username', function(event) {
        		event.preventDefault();
        		if($(this).val().length !=0){
	           		$('#createRoom').removeClass('disabled');
    				$(".usernametooltip").tooltip('disable');  
        			if($("#inputRoomID").val().length != 0){
		           		$('#betreedKamer').removeClass('disabled');
		           	}
        		}
		        else{
		        	$('#createRoom').addClass('disabled');
    				$(".usernametooltip").tooltip('enable');  
        			if($("#inputRoomID").val().length != 0){
		           		$('#betreedKamer').addClass('disabled');
		           	}
		        }
	       	});


        	function makeid(length) {
			   var result           = '';
			   var characters       = 'abcdefghijklmnopqrstuvwxyz0123456789';
			   var charactersLength = characters.length;
			   for ( var i = 0; i < length; i++ ) {
			      result += characters.charAt(Math.floor(Math.random() * charactersLength));
			   }
			   return result;
			}

			$("#logo").click(function(event) {
				$("#logo > img").toggle();
			});

		});
    </script>
</body>

</html>